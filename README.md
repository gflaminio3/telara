# Laravel Telegram Storage (Telara)

A custom Laravel package that provides a storage disk for uploading files to Telegram and retrieving them seamlessly. It integrates effortlessly with Laravel's Filesystem to let you store files through Telegram's API just like you would use S3, local, or any other disk.

<p align="center">
  <img src="https://raw.githubusercontent.com/gflaminio3/telara/master/docs/banner.png" height="300" alt="Laravel Telegram Storage">
  <p align="center">
      <a href="https://packagist.org/packages/gflaminio3/telara"><img alt="Total Downloads" src="https://img.shields.io/packagist/dt/gflaminio3/telara"></a>
      <a href="https://packagist.org/packages/gflaminio3/telara"><img alt="Latest Version" src="https://img.shields.io/packagist/v/gflaminio3/telara"></a>
      <a href="https://packagist.org/packages/gflaminio3/telara"><img alt="License" src="https://img.shields.io/packagist/l/gflaminio3/telara"></a>
  </p>
</p>

---

## Table of Contents

- [Laravel Telegram Storage (Telara)](#laravel-telegram-storage-telara)
  - [Table of Contents](#table-of-contents)
  - [Requirements](#requirements)
  - [Installation](#installation)
  - [Configuration](#configuration)
  - [Usage](#usage)
    - [Basic Usage](#basic-usage)
    - [File Tracking Options](#file-tracking-options)
    - [Logging](#logging)
  - [Advanced Usage](#advanced-usage)
    - [Database Tracking](#database-tracking)
    - [JSON Tracking](#json-tracking)
  - [Testing](#testing)
  - [License](#license)

---

## Requirements

- **PHP 8.3+**  
- **Laravel 9+** (or later versions)  
- A **Telegram bot token** generated by [BotFather](https://t.me/botfather)

## Installation

You can install this package via Composer:

```bash
composer require gflaminio3/telara
```

If you want to publish the config file to your own Laravel project's `config` directory, you can run:

```bash
php artisan vendor:publish --tag=telara-config
```

This will create a `config/telara.php` file where you can specify your Telegram bot token, chat ID, and other settings.

## Configuration

1. **Add Disk in `config/filesystems.php`:**
   ```php
   'disks' => [
       // ...
       'telegram' => [
           'driver'    => 'telara',
           'bot_token' => env('TELEGRAM_BOT_TOKEN'),
           'chat_id'   => env('TELEGRAM_CHAT_ID'),
       ],
   ],
   ```

2. **Set Environment Variables:**
   ```env
   TELEGRAM_BOT_TOKEN=123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11
   TELEGRAM_CHAT_ID=987654321
   ```
   Adjust these values to match your actual Telegram bot token and your desired chat or channel ID.

3. **Package Config (`config/telara.php`):**
   - `track_files`: Enable or disable file tracking.  
   - `tracking_driver`: Decide how to store metadata (`none`, `array`, `database`, or `json`).  
   - `json_tracking_path`: Location of the JSON file if you choose the `json` driver.  
   - `logging.enabled`: Enable or disable package-specific logging.  
   - `logging.channel`: Specify which logging channel to use (e.g., `single`, `stack`).

## Usage

With the package installed and configured, you can interact with Telegram just like any other filesystem disk in Laravel:

### Basic Usage

```php
use Illuminate\Support\Facades\Storage;

// Upload a file
Storage::disk('telegram')->put('my_image.jpg', file_get_contents('path/to/local/image.jpg'));

// Download a file by Telegram file_id
$contents = Storage::disk('telegram')->get($telegramFileId);
```

> **Note:** When uploading, the second argument is the file contents (raw string).  
> When reading, `get()` expects a Telegram `file_id` if you want to retrieve a file from Telegram’s servers.

### File Tracking Options

If `track_files` is enabled, the driver will remember which files have been uploaded. This allows you to:

- `has()` a file by its local path.  
- `delete()` a file from the tracking system (though Telegram itself does not support remote deletion).  
- `listContents()` to see which files have been tracked.

Depending on your `tracking_driver`:

- **`array`**: Tracks file paths in memory only.  
- **`database`**: Saves file data in the `telara_tracked_files` table.  
- **`json`**: Writes file metadata to a JSON file (location from `telara.json_tracking_path`).  
- **`none`**: Disables tracking.

### Logging

When logging is enabled (`telara.logging.enabled` => `true`), each filesystem action (`write`, `read`, `delete`, etc.) is logged to the channel specified by `telara.logging.channel`. You’ll see logs similar to:

```
[2024-12-27 12:00:00] local.INFO: Telara: write {"path":"my_image.jpg","success":true}
```

## Advanced Usage

### Database Tracking

If you choose `database` as your `tracking_driver`, be sure to:

1. Run the provided migration to create the `telara_files` table:
   ```bash
   php artisan migrate
   ```
2. (Optional) Customize the **Telara** model to your liking:
   ```php
   namespace Telara\Models;

   use Illuminate\Database\Eloquent\Model;

   class Telara extends Model
   {
       protected $table = 'telara_files';

       protected $fillable = [
           'file_id',
           'path',
           'caption',
       ];
   }
   ```

### JSON Tracking

If using `json`, make sure to define the path in your `.env` or `config/telara.php`:

```php
'json_tracking_path' => storage_path('app/telara_files.json'),
```

The package will read/write file entries in JSON format. This is a lightweight alternative to a database.

## Testing

You can run tests (if this repository includes them) by executing:

```bash
composer test
```

Or, if you have separate scripts:

```bash
# Lint code
composer lint

# Static analysis
composer test:types

# Unit tests
composer test:unit
```

## License

This project is open-sourced software licensed under the [MIT license](https://opensource.org/licenses/MIT).

Feel free to use, modify, and distribute it as needed to integrate Telegram file storage within your Laravel applications. If you find a bug or want to contribute a new feature, please open an issue or create a pull request on GitHub. Enjoy building with Laravel Telegram Storage!
